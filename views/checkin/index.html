<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0">
        <title>签到记录</title>
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.8/semantic.min.css">
        <script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js" ></script>
        <script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.8/semantic.min.js"></script>
        <script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.9.0/lodash.min.js"></script>
        <script type="application/javascript" src="//cdn.bootcss.com/js-cookie/2.1.0/js.cookie.js"></script>
        <script type="application/javascript" src="../static/jwt-decode.min.js"></script>
        <script type="application/javascript" src="../auth/auth.js"></script>
        <script type="application/javascript">
            $(document).ready(function(){
                //req = { id: "1" }
                //$.get('http://localhost:8089/v1/checkin', req, function(data) {
                //    //$('#dictionary').html(data);
                //    console.log(data)
                //});
                auth_token = Cookies.get('auth_token');
                Cookies.set('imgurl', 'http://127.0.0.1:8089/v1/static/images/');
                var card_tmpl = '';
                $.get('../templates/card-checkin.tmpl', function(data) {
                    card_tmpl = data;
                    $.ajax({
                        url: 'http://127.0.0.1:8089/v1/checkin',
                        dataType: 'jsonp',
                        //type: 'POST',
                        data: {
                            auth_token: auth_token
                            //uid: '571857ed8c55cf8095999850'
                        },
                        success: function(res) {
                            //console.log(res);
                            //console.log(card_tmpl);
                            //var tmpl = _.template('<div class="ui fluid card"><div class="content"><div class="description"><p><%= content %></p></div><div class="meta"><%= date %></div></div></div>');
                            var tmpl = _.template(card_tmpl);
                            var sorted = _.sortBy(res.data, ['timestamp']);
                            console.log(sorted)
                            for(var i = sorted.length - 1; i >= 0; i --) {
                                var c = sorted[i]
                                if(c.create_hour < 10){
                                    c.create_hour = '0' + c.create_hour
                                }
                                if(c.create_min < 10){
                                    c.create_min = '0' + c.create_min
                                }
                                if(c.create_sec < 10){
                                    c.create_sec = '0' + c.create_sec
                                }
                                var date = c.create_year + '年' + c.create_month + '月' + c.create_day + '日' + ' ' + c.create_hour + ":" + c.create_min + ":" + c.create_sec;
                                var html = tmpl({
                                    'content': c.content,
                                    'date': date,
                                    'imgurl': Cookies.get('imgurl'),
                                    'img': c.images[0]
                                });
                                //console.log(html);
                                $('#container').append($(html));
                            }
                        }
                    });
                }).fail(function(jqXHR) {
                    $('#container').html('An error occurred: ' + jqXHR.status).append(jqXHR.responseText);
                });
            });
        </script>
    </head>
    <body>
        <br/>
        <div id="container" class="ui container">
        </div>
        <br/>
    </body>
</html>
