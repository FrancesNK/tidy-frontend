function dataURLtoBlob(a){for(var t=a.split(","),e=t[0].match(/:(.*?);/)[1],n=atob(t[1]),r=n.length,c=new Uint8Array(r);r--;)c[r]=n.charCodeAt(r);return new Blob([c],{type:e})}function prepare(a,t,e){$(a).change(function(a){if(t()){var n=this.files[0],r=new Image;r.onload=function(){var a=r.width,t=r.height,n=a/t;a=parseInt(800),t=parseInt(a/n),canvas=document.createElement("canvas");var c=canvas.getContext("2d");canvas.width=a,canvas.height=t,c.drawImage(r,0,0,a,t);var o=canvas.toDataURL("image/png",.8),i=dataURLtoBlob(o),s=new FormData;s.append("file",i,"image-scaled.png"),$.ajax({url:"https://api.ctidy.com/v1/user/uploadimg",type:"POST",data:s,cache:!1,contentType:!1,enctype:"multipart/form-data",processData:!1,success:function(a){e({guid:a.guid,ext:a.ext,url:o})}})};var c=new FileReader;c.onload=function(){var a=c.result;r.src=a},c.readAsDataURL(n)}})}